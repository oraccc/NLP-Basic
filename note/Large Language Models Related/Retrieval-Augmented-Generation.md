## Retrieval-Augmented Generation for Large Language Models: A Survey

[参考论文](https://arxiv.org/pdf/2312.10997.pdf)

**RAG(Retrieval-Augmented Generation)**， 检索增强生成，即从外部数据库获取额外信息辅助模型生成内容

<img src="..\..\img\rag\rag_instance.png" alt="image-20240226105726901" style="zoom: 50%;" />

**RAG**结合了检索（从大型外部数据库中提取信息）和生成（基于检索到的信息生成答案）两个步骤。RAG通过引入外部知识来源，来增强语言模型的回答能力。

**Fine-Tuning**是指在已有的预训练模型基础上，通过在特定数据集上进行额外的训练来优化模型。这个过程没有引入外部知识，而是调整模型以更好地适应特定任务。



| 优势                                                         | 劣势                                                         |
| :----------------------------------------------------------- | ------------------------------------------------------------ |
| **实时更新** RAG能够访问最新的外部信息，保持知识的时效性     | **外部依赖** RAG的性能高度依赖于外部知识库的质量和覆盖范围。 |
| **减少幻觉** 通过使用外部验证信息，RAG有助于减少语言模型产生的错误或虚构信息 | **实现复杂** RAG的实现比单纯的微调更复杂，需要处理检索和生成的结合 |
| **高透明度** 生成答案时引用外部信息源，增加可信度和可追溯性。 | **生成延迟** 检索过程可能增加回答生成的时间延迟。            |
| **避免重训练** 相比于微调，RAG减少了频繁重训练的需要，因为模型可以通过检索即时获取新信息 | **准确性挑战** 虽然可以减少幻觉，但RAG也面临着确保检索结果准确性和相关性的挑战 |



### RAG 框架

**基础RAG(Naive RAG)**、**高级RAG(Advanced RAG)**和**模块化RAG(Modular RAG)**是检索增强生成在大型语言模型中应用的三种不同形式。

#### Naive RAG

基础RAG是RAG方法的原始形式，它结合了**信息索引，检索和文本生成**三个阶段。在这个框架中，当模型接收到一个查询时，它首先执行一个检索步骤，从一个大型的、结构化的知识库中检索出与查询相关的信息片段。然后，这些检索到的信息被送入一个生成器模型，该模型结合原始查询和检索到的信息来生成回答。基础RAG的关键在于它将检索和生成紧密结合，使得生成的回答能够利用检索到的实时外部信息。

索引过程是数据准备过程中至关重要的初始步骤，它发生在离线状态，涉及几个阶段。它从数据索引开始，其中清理原始数据并删除，然后将各种文件格式(如PDF、HTML、Word和Markdown)转换为标准化的纯文本。为了适应语言模型的上下文限制，该文本然后被分割成更小、更易于管理的块，这个过程称为分块。这些块随后通过嵌入模型转换为向量表示，选择嵌入模型是为了在推导效率和模型大小之间取得平衡。这有助于在检索阶段进行相似性比较。最后，创建一个索引，以键值对的形式存储这些文本块及其矢量嵌入，从而实现高效且可扩展的搜索功能。

检索过程计算查询向量和索引语料库中矢量化块之间的相似性分数。系统对与查询最相似的前K个块进行优先级排序并检索。这些块通常用作扩展的上下文基础，用于处理用户的请求

#### Advanced RAG

高级RAG对基础RAG进行了改进，引入了**预检索(pre-retrieval)**和**后检索(post-retrieval)**优化策略。在预检索阶段，模型会通过对查询进行处理（如扩展或重写）来提高检索的准确性和相关性。在后检索阶段，模型可以对检索到的信息进行进一步的处理，如重新排序、信息压缩或合成，以便更有效地融合到生成步骤中。这种高级RAG通过在检索前后增加额外的处理步骤，提高了回答的质量和相关性。

#### Modular RAG

模块化RAG是一种更灵活的RAG实现，它允许不同的检索和生成模块根据特定的应用需()求进行替换或重新配置。这种方法的关键在于模块化设计，使得研究者和开发者可以针对特定问题选择最合适的检索器和生成器。例如，对于某些特定类型的查询，可以选择特化的检索模块，或者针对特定的生成任务，选择一个适合该场景的生成器。模块化RAG提供了更大的灵活性和适应性，适用于多样化和动态变化的应用场景。



### Retriever

要实现高效而准确的检索涉及两部分的优化：**文档块大小(Document Chunk Size)**优化和**向量模型(Embedding Models)**优化，而考虑到RAG的使用者未必有能力/资源进行模型优化，所以可以着重关注文档大小优化部分。

文中阐述的内容大致如下：较小的文档块可以提高信息检索的精确度，但可能丢失上下文；较大的块提供更多上下文，但可能包含不相关信息。使用者可以根据内容复杂度或查询性质，动态调整块的大小。并通过不同块大小的测试，找到最佳平衡点。



### Generator

生成器决定了最终呈现给用户的答案，文中也给出一些优化的方案。

检索得到相应信息后，在提交至生成器之前需要进行**后检索处理(Post-retrieval Processing)，**指的是进一步处理、过滤或优化检索器从大型文档数据库中检索到的相关信息。然后再进行**信息压缩(Information Compression)**和**结果重排(Result Rerank)**。这一过程的主要目的是提高检索结果的质量，以更好地满足用户需求或后续任务。比如减轻上下文长度限制和对冗余信息的易感性。